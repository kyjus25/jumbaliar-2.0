---
import ButtonModal from "../components/ButtonModal.astro";
import Table from "../components/Table.astro";
import Authed from "../layouts/Authed.astro";

const users = await fetch('http://localhost:3000/services/auth/user').then(i => i.json());
console.log(users);

const cols = [
	{ field: "id", label: "ID" },
	{ field: "firstName", label: "First Name"},
	{ field: "lastName", label: "Last Name"},
    { field: "username", label: "Username"}
];
---

<Authed title="Accounts">
    <div class="bg-black/20 rounded-xl p-4 mb-3 flex items-center justify-between">
        <p>Total Accounts: <span class="text-primary">{users.length}</span></p>
        <ButtonModal btnClasses="btn btn-sm btn-primary" btnText="Add" index="1" title="Add Account" submit="test">
            <input name="username" type="text" placeholder="Username" class="input input-secondary w-full mb-3" />
        </ButtonModal>
    </div>
	<Table cols={cols} rows={users}>
		<div slot="header">
			Test
		</div>
		<div slot="actions">
			{(rowData: any) => (
                // <ButtonModal btnClasses="btn btn-sm" btnText="Edit" index={`${rowData.id}-1`} title="Edit Account">
                //     <input name="username" type="text" placeholder="Username" class="input input-secondary w-full mb-3" />
                // </ButtonModal>
                // <ButtonModal btnClasses="btn btn-sm" btnText="Delete" index={`${rowData.id}-2`} title="Delete Account">
                //     Are you sure you want to delete "{rowData.username}"?
                // </ButtonModal>
                <></>
			)}
		</div>
	</Table>

    <button id="rest">Test</button>

    <script is:inline>
        // const signup = document.getElementById('modalForm1');
        // signup.addEventListener('submit', (event) => {
        //     event.preventDefault();
        //     const payload = {}
        //     Array.from(signup.getElementsByTagName("input")).forEach(i => payload[i.name] = i.value);
        //     console.log(payload);
        // });

        const test = () => {
            console.log('WORKED');
        }
        // document.getElementById('rest').addEventListener('click', () => location.reload() );
    </script>
</Authed>